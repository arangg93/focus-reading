<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Reading Training (Advanced)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=Urbanist:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* 1. SETUP & RESET */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            background-color: #000; /* 완전한 몰입을 위한 블랙 배경 */
            color: #fff;
            font-family: 'Noto Sans KR', sans-serif;
            overflow: hidden; /* 스크롤 방지 */
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 2. SLIDE CONTAINER */
        .slide-deck {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 1600px; /* 대형 화면 대응 */
            max-height: 900px;
        }

        .slide-container {
            display: none; /* 기본적으로 숨김, JS로 제어 */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background-color: #000;
            padding: 20px;
        }

        .slide-container.active {
            display: flex;
        }

        /* 3. TYPOGRAPHY */
        h1, h2 {
            font-weight: 900;
            line-height: 1.2;
            text-align: center;
        }

        /* Title Slide */
        .title-slide h1 { font-size: 80px; color: #deff9a; margin-bottom: 20px; }
        .title-slide p { font-size: 24px; color: #a3a3a3; }
        .instruction { margin-top: 40px; font-size: 18px; color: #fff; border: 1px solid #333; padding: 15px 30px; border-radius: 50px; }

        /* Center Phrase Style */
        .phrase-center {
            font-size: 90px;
            color: #fff;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            word-break: keep-all; 
        }

        /* Peripheral Layout */
        .peripheral-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center; /* Center align items vertically */
            padding: 0 5%;
            position: relative;
        }

        .word-column {
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        /* Vertical Mode (Default) */
        .word-column.vertical {
            flex-direction: column;
            justify-content: space-around;
            height: 100%;
            width: 20%; /* 좁은 폭 */
        }

        /* Horizontal Mode */
        .word-column.horizontal {
            flex-direction: row;
            justify-content: space-between; /* 단어 사이 간격 벌림 */
            flex-wrap: wrap; /* 필요시 줄바꿈 */
            height: auto;
            width: 40%; /* 넓은 폭 (중앙 침범 방지) */
            gap: 20px;
        }

        .word-item {
            font-size: 50px;
            color: #deff9a;
            font-weight: 700;
            text-align: center;
        }

        /* Crosshair for Center Focus */
        .fixation-point {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background-color: #333;
            border-radius: 50%;
            opacity: 0.5;
        }

        /* 4. CONTROLS */
        .controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 20px;
            background-color: rgba(20, 20, 20, 0.95);
            padding: 15px 30px;
            border-radius: 50px;
            border: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ccc;
            font-size: 14px;
            white-space: nowrap;
        }

        .divider {
            width: 1px;
            height: 20px;
            background-color: #444;
        }

        button {
            padding: 8px 16px;
            font-size: 15px;
            font-weight: bold;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Noto Sans KR', sans-serif;
            transition: all 0.2s;
            white-space: nowrap;
        }

        #start-btn { background-color: #deff9a; color: #000; }
        #start-btn:hover { background-color: #cfff6b; }
        
        #stop-btn { background-color: #ff5f5f; color: #fff; display: none; }
        #stop-btn:hover { background-color: #ff3b3b; }
        
        #reset-btn { background-color: #444; color: #fff; }
        #reset-btn:hover { background-color: #555; }

        input[type=range] {
            width: 80px;
            cursor: pointer;
        }

        /* Settings Buttons */
        .setting-btn {
            background-color: #333;
            color: #888;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        .setting-btn:hover { background-color: #444; }
        .setting-btn.active {
            background-color: #deff9a;
            color: #000;
        }

        /* Progress Bar */
        .progress-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            height: 5px;
            background-color: #deff9a;
            width: 0%;
            transition: width 0.3s linear;
        }
    </style>
</head>
<body>

    <div class="slide-deck" id="deck">
        <!-- Slide 0: Title -->
        <div class="slide-container title-slide active" id="title-slide">
            <h1>포커스 리딩<br>고급 훈련</h1>
            <p>구문 인식 & 주변 시야 확장 (무한 반복)</p>
            <div class="instruction">
                <i class="fa-solid fa-eye"></i> F11을 눌러 전체화면으로 만드세요.
            </div>
        </div>
        <!-- Slides injected by JS -->
    </div>

    <div class="progress-bar" id="progress"></div>

    <div class="controls">
        <!-- Playback Controls -->
        <div class="control-group">
            <button id="start-btn" onclick="startTraining()"><i class="fa-solid fa-play"></i> 시작</button>
            <button id="stop-btn" onclick="stopTraining()"><i class="fa-solid fa-stop"></i> 중지</button>
            <button id="reset-btn" onclick="resetAndReshuffle()"><i class="fa-solid fa-shuffle"></i> 리셋</button>
        </div>

        <div class="divider"></div>

        <!-- Layout Control (New) -->
        <div class="control-group">
            <span>단어 배열</span>
            <div>
                <button class="setting-btn active" id="layout-vert" onclick="setLayout('vertical')">세로</button>
                <button class="setting-btn" id="layout-horiz" onclick="setLayout('horizontal')">가로</button>
            </div>
        </div>

        <div class="divider"></div>

        <!-- Word Count Control -->
        <div class="control-group">
            <span>단어수</span>
            <div id="count-buttons">
                <button class="setting-btn active count-btn" onclick="setWordCount(2)">2</button>
                <button class="setting-btn count-btn" onclick="setWordCount(3)">3</button>
                <button class="setting-btn count-btn" onclick="setWordCount(4)">4</button>
                <button class="setting-btn count-btn" onclick="setWordCount(5)">5</button>
            </div>
        </div>

        <div class="divider"></div>

        <!-- Speed Control -->
        <div class="control-group">
            <span>속도</span>
            <input type="range" id="speed-range" min="0.5" max="2.0" step="0.1" value="1.0" oninput="updateSpeed(this.value)">
            <span id="speed-display" style="width: 35px; text-align:right;">1.0s</span>
        </div>
    </div>

    <script>
        // 1. Data Pools
        const phrasePool = [
            "성공하는 습관", "전략적 사고", "핵심 파악 능력", "비판적 책읽기", "창조적 리더십",
            "무한한 가능성", "탁월한 성과", "집중과 몰입", "변화의 시작", "긍정의 힘",
            "목표 달성 전략", "지식의 최전선", "생각의 힘", "실행이 답이다", "내면의 성장",
            "압도적인 몰입", "질문하는 습관", "본질을 꿰뚫다", "한계를 넘어서", "지혜의 바다",
            "통찰의 순간", "혁신적 아이디어", "논리적 사고", "창의적 해결", "강력한 동기부여",
            "멈추지 않는 도전", "스스로의 확신", "미래를 여는 열쇠", "독서의 즐거움", "배움의 기쁨"
        ];

        const wordPool = [
            "독서", "속독", "정독", "다독", "통찰", "이해", "분석", "종합", "적용", "실천",
            "집중", "몰입", "기억", "망각", "복습", "예습", "질문", "대답", "토론", "발표",
            "요약", "발췌", "메모", "기록", "정리", "구조", "맥락", "핵심", "주제", "소재",
            "논리", "근거", "주장", "설득", "비판", "창의", "상상", "연상", "추론", "판단",
            "지식", "지혜", "정보", "데이터", "패턴", "원리", "법칙", "이론", "실무", "경험",
            "학습", "공부", "연구", "탐구", "호기심", "발견", "해결", "성장", "발전", "진보",
            "성공", "실패", "도전", "극복", "용기", "열정", "끈기", "인내", "노력", "성취",
            "목표", "계획", "비전", "사명", "가치", "철학", "신념", "확신", "믿음", "자신감",
            "변화", "혁신", "개혁", "도약", "비상", "탈피", "각성", "자각", "반성", "회고",
            "경제", "경영", "시장", "고객", "수요", "공급", "가격", "가치", "비용", "수익",
            "컴퓨터", "인터넷", "소프트웨어", "알고리즘", "코딩", "개발", "서버", "클라우드", "데이터",
            "인공지능", "AI", "머신러닝", "딥러닝", "로봇", "드론", "자율주행", "블록체인", "메타버스",
            "역사", "세계사", "한국사", "전쟁", "혁명", "문명", "고대", "중세", "근대", "현대",
            "철학", "사상", "윤리", "도덕", "종교", "신화", "전설", "민담", "설화", "우화",
            "가족", "부모", "자녀", "형제", "자매", "친구", "연인", "사랑", "이별", "만남",
            "일취월장", "괄목상대", "대기만성", "유비무환", "고진감래", "새옹지마", "전화위복", "청출어람",
            "가능성", "잠재력", "한계", "초월", "극복", "승리", "패배", "모험", "탐험", "여행"
        ];

        // 2. Settings & Variables
        let currentInterval = 1000; // ms
        let wordsPerSide = 2; // Default
        let layoutMode = 'vertical'; // 'vertical' or 'horizontal'
        let currentSlide = 0;
        let intervalId = null;
        let slides = [];
        
        // 3. Elements
        const deck = document.getElementById('deck');
        const progressBar = document.getElementById('progress');
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const resetBtn = document.getElementById('reset-btn');

        // 4. Helper Functions
        function shuffle(array) {
            let arr = [...array];
            let currentIndex = arr.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [arr[currentIndex], arr[randomIndex]] = [arr[randomIndex], arr[currentIndex]];
            }
            return arr;
        }

        // --- Settings Change Handlers ---
        function setWordCount(count) {
            wordsPerSide = count;
            document.querySelectorAll('.count-btn').forEach(btn => {
                btn.classList.remove('active');
                if(parseInt(btn.innerText) === count) btn.classList.add('active');
            });
            if (!intervalId) resetAndReshuffle();
        }

        function setLayout(mode) {
            layoutMode = mode;
            // UI Toggle
            document.getElementById('layout-vert').classList.toggle('active', mode === 'vertical');
            document.getElementById('layout-horiz').classList.toggle('active', mode === 'horizontal');
            
            if (!intervalId) resetAndReshuffle();
        }

        function updateSpeed(val) {
            currentInterval = val * 1000;
            document.getElementById('speed-display').innerText = val + "s";
            
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = setInterval(nextSlide, currentInterval);
            }
        }

        // 5. Slide Generation Logic
        function generateSlides() {
            const existing = document.querySelectorAll('.generated-slide');
            existing.forEach(el => el.remove());

            const shuffledPhrases = shuffle(phrasePool);
            const shuffledWords = shuffle(wordPool);
            let wordIndex = 0;

            // Generate 40 sets
            for (let i = 0; i < 40; i++) {
                // 1. Center Phrase
                const phrase = shuffledPhrases[i % shuffledPhrases.length];
                const centerSlide = document.createElement('div');
                centerSlide.className = 'slide-container generated-slide';
                centerSlide.innerHTML = `<h1 class="phrase-center">${phrase}</h1>`;
                deck.appendChild(centerSlide);

                // 2. Peripheral Slide
                const peripheralSlide = document.createElement('div');
                peripheralSlide.className = 'slide-container generated-slide';
                
                // Get words
                const leftWords = [];
                const rightWords = [];
                for(let k=0; k<wordsPerSide; k++) {
                    leftWords.push(shuffledWords[wordIndex % shuffledWords.length]);
                    wordIndex++;
                }
                for(let k=0; k<wordsPerSide; k++) {
                    rightWords.push(shuffledWords[wordIndex % shuffledWords.length]);
                    wordIndex++;
                }

                let leftHtml = leftWords.map(w => `<div class="word-item">${w}</div>`).join('');
                let rightHtml = rightWords.map(w => `<div class="word-item">${w}</div>`).join('');

                // Apply correct class based on layoutMode
                peripheralSlide.innerHTML = `
                    <div class="peripheral-container">
                        <div class="word-column left-col ${layoutMode}">${leftHtml}</div>
                        <div class="fixation-point"></div>
                        <div class="word-column right-col ${layoutMode}">${rightHtml}</div>
                    </div>
                `;
                deck.appendChild(peripheralSlide);
            }

            slides = document.querySelectorAll('.slide-container');
        }

        // 6. Playback Logic
        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.remove('active');
                if (i === index) slide.classList.add('active');
            });

            // Progress Bar (Loop)
            const totalGenerated = slides.length - 1; 
            let progressIndex = index;
            if (progressIndex === 0) progressIndex = 0; 
            
            const percentage = (progressIndex / totalGenerated) * 100;
            progressBar.style.width = percentage + '%';
        }

        function nextSlide() {
            if (currentSlide < slides.length - 1) {
                currentSlide++;
            } else {
                currentSlide = 1; // Infinite Loop
            }
            showSlide(currentSlide);
        }

        function startTraining() {
            if (intervalId) return;

            if(currentSlide === 0) currentSlide = 1;
            showSlide(currentSlide);

            startBtn.style.display = 'none';
            stopBtn.style.display = 'inline-block';
            resetBtn.disabled = true;
            resetBtn.style.opacity = 0.5;
            
            // Disable layout changing while running to avoid chaos
            document.querySelectorAll('.setting-btn').forEach(b => b.disabled = true);
            document.getElementById('speed-range').disabled = false; // Speed is live

            intervalId = setInterval(nextSlide, currentInterval);
        }

        function stopTraining() {
            if (!intervalId) return;
            clearInterval(intervalId);
            intervalId = null;

            startBtn.style.display = 'inline-block';
            stopBtn.style.display = 'none';
            startBtn.innerHTML = '<i class="fa-solid fa-play"></i> 계속하기';
            
            resetBtn.disabled = false;
            resetBtn.style.opacity = 1;
            document.querySelectorAll('.setting-btn').forEach(b => b.disabled = false);
        }

        function resetAndReshuffle() {
            stopTraining();
            generateSlides(); 
            currentSlide = 0;
            showSlide(0);
            startBtn.innerHTML = '<i class="fa-solid fa-play"></i> 훈련 시작';
            progressBar.style.width = '0%';
        }

        // Init
        window.onload = function() {
            generateSlides();
            slides = document.querySelectorAll('.slide-container');
            showSlide(0);
        };

    </script>
</body>
</html>
